<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadorossa | Profile</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="wrapper">
    <header class="profile-box">
        <img src="img/avatar.jpg" class="avatar-sq" alt="Shadorossa" onerror="this.src='https://via.placeholder.com/200'">
        <div class="profile-info">
            <h1>SHADOROSSA</h1>
            <div class="stats-container">
                <div>JUEGOS <span id="count-games" class="stat-val">0</span></div>
                <div>ANIME <span id="count-anime" class="stat-val">0</span></div>
                <div>MANGA <span id="count-manga" class="stat-val">0</span></div>
            </div>
        </div>
    </header>

    <div class="deco-line"></div>

    <span class="section-tag">Top Selected // Favoritos</span>
    <section id="favorites-grid" class="fav-grid">
        </section>

    <div class="deco-line" style="width: 40%;"></div>

    <div class="filter-nav">
        <button class="filter-btn active" onclick="filter('all', this)">TODO</button>
        <button class="filter-btn" onclick="filter('game', this)">JUEGOS</button>
        <button class="filter-btn" onclick="filter('anime', this)">ANIME</button>
        <button class="filter-btn" onclick="filter('manga', this)">MANGA</button>
    </div>

    <main id="main-grid" class="general-grid">
        </main>
</div>

<script>
    let db = [];

    async function load() {
        try {
            // Cargar datos (AsegÃºrate de que los archivos existen en data/)
            const [g, a, m, favs] = await Promise.all([
                fetch('data/games.json').then(r => r.json()).catch(() => []),
                fetch('data/anime.json').then(r => r.json()).catch(() => []),
                fetch('data/manga.json').then(r => r.json()).catch(() => []),
                fetch('data/favorites.json').then(r => r.json()).catch(() => [])
            ]);

            // Unificar base de datos
            db = [
                ...g.map(i => ({...i, type: 'game'})),
                ...a.map(i => ({...i, type: 'anime'})),
                ...m.map(i => ({...i, type: 'manga'}))
            ];

            // Actualizar contadores
            document.getElementById('count-games').innerText = g.length;
            document.getElementById('count-anime').innerText = a.length;
            document.getElementById('count-manga').innerText = m.length;

            // Renderizar Favoritos (Basado en el orden de favorites.json)
            const favData = favs.map(title => db.find(item => item.title.toLowerCase() === title.toLowerCase())).filter(Boolean);
            renderFavs(favData);

            // Renderizar General (Resto ordenado A-Z)
            const generalData = db.filter(item => !favs.some(ft => ft.toLowerCase() === item.title.toLowerCase()))
                                  .sort((x, y) => x.title.localeCompare(y.title));
            renderGeneral(generalData);

        } catch (e) { console.error("Error cargando JSONs", e); }
    }

    function renderFavs(items) {
        document.getElementById('favorites-grid').innerHTML = items.map((item, i) => `
            <div class="fav-card">
                <div class="rank-tag">#0${i+1}</div>
                <img src="${item.image}" alt="${item.title}">
                <div class="fav-info">
                    <strong>${item.title}</strong><br>
                    <small style="color:#555">${item.type.toUpperCase()}</small>
                </div>
            </div>
        `).join('');
    }

    function renderGeneral(items) {
        document.getElementById('main-grid').innerHTML = items.map(item => `
            <div class="tile" data-type="${item.type}">
                <img src="${item.image}" title="${item.title}" loading="lazy">
            </div>
        `).join('');
    }

    function filter(type, btn) {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        const tiles = document.querySelectorAll('.tile');
        tiles.forEach(t => {
            t.style.display = (type === 'all' || t.dataset.type === type) ? 'block' : 'none';
        });
    }

    window.onload = load;
</script>
</body>
</html>