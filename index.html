<!DOCTYPE html>
<html lang="es" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shadorossa Collection</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="main-container">
        <header class="profile-section">
            <div class="avatar-container">
                <img src="img/avatar.jpg" alt="Avatar" class="avatar" onerror="this.src='https://via.placeholder.com/150/334155/ffffff?text=S'">
            </div>
            <div class="profile-content">
                <h1 class="profile-title">Shadorossa Archive</h1>
                <p class="profile-bio">Colección digital sincronizada. Explorando mundos virtuales, una historia a la vez.</p>
                
                <div class="stats-badges">
                    <div class="stat-badge">Total: <span id="total-count" class="text-accent">0</span></div>
                    <div class="stat-badge"><span id="games-count">0</span> Juegos</div>
                    <div class="stat-badge"><span id="anime-count">0</span> Anime</div>
                    <div class="stat-badge"><span id="manga-count">0</span> Manga</div>
                </div>
            </div>
        </header>

        <div class="section-header">
            <h2 class="section-title">Selección Destacada <span class="text-accent">//</span> Favoritos</h2>
        </div>
        <div id="favorites-grid" class="gallery-grid featured-grid">
            </div>

        <div class="section-header flex-header">
            <h2 class="section-title">Biblioteca Completa</h2>
            <nav class="filter-nav">
                <button class="filter-btn active" onclick="filter('all', this)">Todo</button>
                <button class="filter-btn" onclick="filter('game', this)">Juegos</button>
                <button class="filter-btn" onclick="filter('anime', this)">Anime</button>
                <button class="filter-btn" onclick="filter('manga', this)">Manga</button>
            </nav>
        </div>

        <main id="main-grid" class="gallery-grid">
            </main>
    </div>

    <script>
        let fullDatabase = [];

        async function init() {
            try {
                const [games, anime, manga, favNames] = await Promise.all([
                    fetch('data/games.json').then(r => r.json()).catch(() => []),
                    fetch('data/anime.json').then(r => r.json()).catch(() => []),
                    fetch('data/manga.json').then(r => r.json()).catch(() => []),
                    fetch('data/favorites.json').then(r => r.json()).catch(() => [])
                ]);

                const g = games.map(i => ({ ...i, type: 'game' }));
                const a = anime.map(i => ({ ...i, type: 'anime' }));
                const m = manga.map(i => ({ ...i, type: 'manga' }));
                fullDatabase = [...g, ...a, ...m];

                document.getElementById('total-count').innerText = fullDatabase.length;
                document.getElementById('games-count').innerText = g.length;
                document.getElementById('anime-count').innerText = a.length;
                document.getElementById('manga-count').innerText = m.length;

                const favorites = favNames.map(name => 
                    fullDatabase.find(item => item.title.toLowerCase() === name.toLowerCase())
                ).filter(Boolean);
                renderGrid(favorites, 'favorites-grid');

                const general = fullDatabase
                    .filter(item => !favNames.some(f => f.toLowerCase() === item.title.toLowerCase()))
                    .sort((a, b) => a.title.localeCompare(b.title));
                renderGrid(general, 'main-grid');

            } catch (e) { console.error("Error:", e); }
        }

        function renderGrid(data, containerId) {
            const container = document.getElementById(containerId);
            // Notar el cambio en la estructura HTML de la tarjeta para el nuevo CSS
            container.innerHTML = data.map(item => `
                <div class="gallery-item" data-type="${item.type}">
                    <div class="poster-container">
                        <img src="${item.image}" alt="${item.title}" loading="lazy">
                        <div class="overlay">
                            <div class="overlay-content">
                                <h3 class="work-title">${item.title}</h3>
                                <div class="work-meta">
                                    <span class="meta-type">${item.type}</span>
                                    ${item.score ? `<span class="meta-score">★ ${item.score}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function filter(type, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const items = document.querySelectorAll('#main-grid .gallery-item');
            items.forEach(item => {
                item.style.display = (type === 'all' || item.getAttribute('data-type') === type) ? 'block' : 'none';
            });
        }
        window.onload = init;
    </script>
</body>
</html>